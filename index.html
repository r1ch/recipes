---
title: Main
layout: default
---
<h1>Recipes</h1>
  <div class = "row" id="app">
    <div class = "col-sm-6">
      <a :href="thisWeekLink">Link to share</a>
      <table class="table table-striped-columns" v-if = "picked.length > 0">
        <thead>
          <tr>
            <th>Ingredient</th>
            <th>Recipes</th>
            <th>Amount</th>
            <th>Unit</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for = "item in shoppingList">
            <td>((item.name))</td>
            <td>((item.recipes))</td>
            <td>((item.amount))</td>
            <td>((item.unit))</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class = "col-sm-6">
      <table class="table table-striped-columns">
        <thead>
          <tr>
            <th>Pick</th>
            <th>Title</th>
            <th>Image</th>
            <th>Time</th>
            <th>Number of ingredients</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for = "(recipe, id) in recipes">
            <td><input type="checkbox" v-model="picked" :value="id"></td>
            <td><a :href="recipe.url">((recipe.title))</a></td>
            <td><img style="max-width:100px" class="img-fluid" :src="`/images/${id}.jpg`"></td>
            <td>((recipe.totalTime))</td>
            <td>((ingredientsByRecipe[id].length))</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
<script type="module">
  const { createApp, ref, computed } = Vue
  import {r, ibR} from './recipes.js'
  const app = createApp({
      setup() {
        const picked = ref([])
        const recipes = ref(r)
        const ingredientsByRecipe = ref(ibR)
        const thisWeekLink = computed(()=>{
          return `/thisweek.html?${picked.value.map(v=>`r=${v}`).join("&")}`
        })
        const shoppingList = computed(()=>{
          const totals = {}
          for (const recipeId of picked.value) {
            const ingredients = ingredientsByRecipe.value[recipeId] || []
            for (const ing of ingredients) {
              if (!totals[ing.type]) {
                totals[ing.type] = {
                  ...ing,
                  amount: Number(ing.amount) || 0,
                  recipes: 1
                }
              } else {
                totals[ing.type].amount += Number(ing.amount) || 0
                totals[ing.type].recipes++
              }
            }
          }
    
          return Object.values(totals)
        })
        return {
          recipes,
          ingredientsByRecipe,
          picked,
          shoppingList,
          thisWeekLink
        }
      }
    })
  app.config.compilerOptions.delimiters = ['((', '))']
  app.mount('#app')
</script>
